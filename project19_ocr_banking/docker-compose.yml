version: '3.8'

services:
  ocr-api:
    build: .
    container_name: ocr_banking_api
    ports:
      - "8000:8000"
    volumes:
      - ./data:/app/data
      - ./models:/app/models
      - ./config:/app/config
    environment:
      - DETECTOR_TYPE=${DETECTOR_TYPE:-craft}
      - RECOGNIZER_TYPE=${RECOGNIZER_TYPE:-vietocr}
      - DEVICE=${DEVICE:-cpu}
      - API_HOST=${API_HOST:-0.0.0.0}
      - API_PORT=${API_PORT:-8000}
      - LOG_LEVEL=${LOG_LEVEL:-info}
    restart: unless-stopped
    networks:
      - ocr-network
  
  ocr-web:
    build:
      context: .
      dockerfile: Dockerfile.web
    container_name: ocr_banking_web
    ports:
      - "8501:8501"
    volumes:
      - ./data:/app/data
      - ./models:/app/models
      - ./config:/app/config
    environment:
      - API_URL=http://ocr-api:8000
    depends_on:
      - ocr-api
    restart: unless-stopped
    networks:
      - ocr-network

networks:
  ocr-network:
    driver: bridge

volumes:
  data:
  models:
